"""Minimal translation helper for UI strings."""
from __future__ import annotations

from typing import Dict

STRINGS_EN: Dict[str, str] = {
    "settings.title": "Settings",
    "settings.status.label": "Status:",
    "settings.status.downloaded": "Downloaded",
    "settings.status.not_downloaded": "Not downloaded",
    "settings.status.configured": "Configured",
    "settings.status.not_configured": "Not configured",
    "settings.size.label": "Size:",
    "settings.button.download": "Download",
    "settings.button.delete": "Delete",
    "settings.button.check": "Check",
    "settings.translator.api_key": "API key",
    "settings.translator.endpoint": "Endpoint",
    "settings.translator.have_api_button": "I have an API key",
    "settings.translator.hide_api_button": "Hide API settings",
    "settings.translator.api_check_success": "API settings look OK.",
    "settings.translator.api_check_failed": "Enter a valid API key first.",
    "tabs.general": "General",
    "tabs.ocr": "OCR",
    "tabs.translator": "Translator",
    "tabs.appearance": "Appearance",
    "buttons.save": "Save",
    "buttons.cancel": "Cancel",
    "buttons.apply": "Apply",
    "general.language": "Interface language:",
    "general.open_last": "Open last project on startup",
    "general.autosave": "Autosave project",
    "general.autosave_interval": "Autosave interval:",
    "general.autosave_suffix": "min",
    "appearance.scale": "UI scale:",
    "appearance.theme": "Color theme:",
    "appearance.fit": "Fit-to-width:",
    "appearance.theme.system": "System",
    "appearance.theme.light": "Light",
    "appearance.theme.dark": "Dark",
    "table.id": "ID",
    "table.original": "Original",
    "table.translation": "Translation",
    "table.type": "Type",
    "table.enabled": "Enabled",
    "table.confidence": "Conf",
    "editor.ocr_page": "OCR + Translate (page)",
    "editor.retranslate_selected": "Re-translate selected",
    "editor.refresh_canvas": "Refresh right canvas",
    "editor.add_block": "Add block",
    "editor.delete_block": "Delete block",
    "block_type.dialog": "dialog",
    "block_type.narration": "narration",
    "block_type.sfx": "sfx",
    "block_type.system": "system",
    "menu.file": "File",
    "menu.title": "Title",
    "menu.settings": "Settings",
    "menu.title_settings": "Title settings...",
    "menu.view": "View",
    "menu.help": "Help",
    "action.open_folder": "Open Folder...",
    "action.save_project": "Save Project",
    "action.export_page": "Export current page",
    "action.export_page_layered": "Export page (OpenRaster)",
    "action.export_chapter": "Export current chapter",
    "action.exit": "Exit",
    "action.title_settings": "Title Settings...",
    "action.show_overlays": "Show translation mask",
    "action.about": "About",
    "action.ocr_translate": "OCR + Translate",
    "action.overlay": "Overlay",
    "action.toggle_editor": "Show block list",
    "action.reset_layout": "Reset layout",
    "toolbar.mask": "Mask overlay",
    "toolbar.mask_tooltip": "Show translation mask on/off",
    "toolbar.text": "Text",
    "toolbar.text_tooltip": "Show translated text bubbles",
    "toolbar.sfx": "SFX",
    "toolbar.sfx_tooltip": "Show SFX layer",
    "toolbar.brush": "Brush",
    "toolbar.brush_tooltip": "Brush tool",
    "toolbar.eraser": "Eraser",
    "toolbar.eraser_tooltip": "Eraser tool",
    "toolbar.eyedropper": "Eyedropper",
    "toolbar.eyedropper_tooltip": "Pick color from translated page",
    "toolbar.hand": "Pan",
    "toolbar.hand_tooltip": "Hand tool (pan view)",
    "toolbar.color": "Color",
    "toolbar.color_tooltip": "Choose brush color",
    "toolbar.zoom_in": "Zoom in",
    "toolbar.zoom_in_tooltip": "Zoom in the translated page",
    "toolbar.zoom_out": "Zoom out",
    "toolbar.zoom_out_tooltip": "Zoom out the translated page",
    "toolbar.zoom_reset": "Reset zoom",
    "toolbar.zoom_reset_tooltip": "Reset zoom to 100%",
    "toolbar.zoom_fit_width": "Fit width",
    "toolbar.zoom_fit_width_tooltip": "Fit translated page to width",
    "title.settings": "Title settings",
    "title.about": "About",
    "label.original_language": "Original language",
    "label.target_language": "Target language",
    "label.skip_sfx_default": "Do not translate SFX by default",
    "label.content_type": "Content type",
    "label.color_mode": "Color mode",
    "label.status": "Status:",
    "label.size": "Size:",
    "option.standard": "Standard / All ages",
    "option.adult": "Adult / 18+ (hentai)",
    "option.bw": "Black & white",
    "option.color": "Full color / webtoon",
    "status.downloaded": "Downloaded",
    "status.not_downloaded": "Not downloaded",
    "actions.download": "Download",
    "actions.delete": "Delete",
    "api.key": "API key",
    "api.endpoint": "Endpoint",
    "api.check": "Check",
    "error.no_download_url": "Download URL is not configured for this engine.",
    "error.enter_api_key": "Enter API key first.",
    "info.api_valid": "API key accepted.",
    "info.nothing_to_delete": "Nothing to delete.",
    "confirm.delete_models": "Delete downloaded models for this engine?",
    "msg.no_project": "Open a project folder first.",
    "msg.no_pages": "Project has no pages.",
    "msg.invalid_index": "Current page index is invalid.",
    "msg.no_session": "There is no session for the current page yet. Run OCR and translation first.",
    "msg.export_done": "Page exported to:",
    "msg.export_error": "Failed to export page:",
    "msg.export_title": "Export done",
    "msg.export_chapter_title": "Export chapter",
    "msg.no_pages_for_chapter": "No pages found for chapter {chapter}.",
    "msg.export_summary": "Chapter {chapter} export finished.",
    "msg.export_counts": "Exported pages: {ok} / {total}.",
    "msg.export_skipped": "Skipped pages (no session or error): {pages}",
    "msg.overlay_nothing": "No enabled blocks with text for overlay.",
    "msg.overlay_nodata": "Run OCR/translation first for this page.",
    "msg.no_data": "No data",
    "msg.no_project_title": "No project",
    "msg.error": "Error",
    "msg.translation_error": "Translation error",
    "msg.ocr_translation_error": "OCR/translation error",
    "msg.overlay_title": "Nothing to show",
    "msg.about_text": "{app}\nSimple desktop tool for OCR and translation of manga.",
    "nav.page_label": "Ch. {chapter}, page {page} ({current} / {total})",
    "status.project_saved": "Project saved.",
    "status.project_opened": "Opened project: {name}",
    "status.overlay_shown": "Overlay shown for page {page} (blocks: {blocks})",
    "status.overlay_hidden": "Overlay hidden for page {page}",
    "status.ocr_done": "OCR and translation completed for page {page} (blocks: {blocks})",
    "status.translation_updated": "Translation updated for {count} block(s) on page {page}",
    "status.ready": "Ready",
    "status.settings_saved": "Settings saved.",
    "msg.ocr_not_configured": "Select an OCR engine in Settings first.",
    "msg.translator_not_configured": "Select a translator in Settings first.",
    "ocr.easyocr.name": "EasyOCR",
    "ocr.easyocr.description": (
        "Offline OCR with multilingual detection and recognition models (JP/KR/EN/CH). "
        "Works on CPU; GPU speeds up processing."
    ),
    "ocr.paddleocr.name": "PaddleOCR (PP-OCRv3)",
    "ocr.paddleocr.description": (
        "Offline OCR using PP-OCRv3 multilingual models. High quality but heavy downloads; "
        "benefits from GPU acceleration."
    ),
    "ocr.tesseract.name": "Tesseract (tessdata_best)",
    "ocr.tesseract.description": (
        "Offline classical OCR with tessdata_best models. Best for clean scans and simple fonts; "
        "slower and less robust for manga than EasyOCR/PaddleOCR."
    ),
    "ocr.google_vision.name": "Google Vision",
    "ocr.google_vision.description": (
        "Cloud OCR from Google. Requires Google Cloud API key and billing; no local models to download."
    ),
    "ocr.azure_cv.name": "Azure Computer Vision",
    "ocr.azure_cv.description": (
        "Cloud OCR from Azure. Requires Azure endpoint and API key; runs fully in the cloud."
    ),
    "translator.deepl.name": "DeepL",
    "translator.deepl.description": (
        "Can run without an API key via web mode (slower, with limits). If you have a key, enable API mode below for faster and more reliable translation."
    ),
    "translator.google.name": "Google Translate",
    "translator.google.description": (
        "Works without an API key in web mode by default. Provide an API key to switch to API mode for higher limits and stability."
    ),
    "translator.yandex.name": "Yandex Translate",
    "translator.yandex.description": (
        "Supports web mode without an API key. If you have a key, enable API mode for better stability and speed."
    ),
    "translator.azure.name": "Azure Translate",
    "translator.azure.description": (
        "Requires Azure Translator endpoint and API key. API mode only; no web/scrape mode available."
    ),
    "translator.openai.name": "OpenAI (LLM)",
    "translator.openai.description": (
        "LLM-based translation. Requires an API key (and optional custom endpoint) to run."
    ),
    "translator.argos.name": "Argos Translate",
    "translator.argos.description": (
        "Offline translator using Argos models. Downloads language-pair packages and works fully locally after that."
    ),
    "translator.marian.name": "Marian / M2M / NLLB (HF)",
    "translator.marian.description": (
        "Offline HuggingFace translators (MarianMT/M2M/NLLB). Large models; GPU recommended for speed, CPU fallback is possible but slower."
    ),
}

STRINGS_RU: Dict[str, str] = {
    "settings.status.label": "Статус:",
    "settings.status.downloaded": "Скачано",
    "settings.status.not_downloaded": "Не скачано",
    "settings.status.configured": "Настроено",
    "settings.status.not_configured": "Не настроено",
    "settings.size.label": "Размер:",
    "settings.button.download": "Скачать",
    "settings.button.delete": "Удалить",
    "settings.button.check": "Проверить",
    "settings.translator.api_key": "API-ключ",
    "settings.translator.endpoint": "Endpoint",
    "settings.translator.have_api_button": "У меня есть API-ключ",
    "settings.translator.hide_api_button": "Скрыть настройки API",
    "settings.translator.api_check_success": "Настройки API выглядят корректно.",
    "settings.translator.api_check_failed": "Сначала введите ключ (и endpoint, если нужен).",
    "settings.title": "Настройки",
    "tabs.general": "Общие",
    "tabs.ocr": "OCR",
    "tabs.translator": "Переводчик",
    "tabs.appearance": "Оформление",
    "buttons.save": "Сохранить",
    "buttons.cancel": "Отмена",
    "buttons.apply": "Применить",
    "general.language": "Язык интерфейса:",
    "general.open_last": "Открывать последний проект при запуске",
    "general.autosave": "Автосохранение проекта",
    "general.autosave_interval": "Интервал автосохранения:",
    "general.autosave_suffix": "мин",
    "appearance.scale": "Масштаб интерфейса:",
    "appearance.theme": "Цветовая тема:",
    "appearance.fit": "Подгонка по ширине:",
    "appearance.theme.system": "Системная",
    "appearance.theme.light": "Светлая",
    "appearance.theme.dark": "Тёмная",
    "table.id": "ID",
    "table.original": "Оригинал",
    "table.translation": "Перевод",
    "table.type": "Тип",
    "table.enabled": "?????",
    "table.confidence": "????.",
    "editor.ocr_page": "OCR + ????? (???????)",
    "editor.retranslate_selected": "????????? ????????",
    "editor.refresh_canvas": "???????? ??? ?????",
    "editor.add_block": "???????? ?????",
    "editor.delete_block": "??????? ?????",
    "block_type.dialog": "диалог",
    "block_type.narration": "нарратив",
    "block_type.sfx": "sfx",
    "block_type.system": "системный",
    "menu.file": "Файл",
    "menu.title": "Тайтл",
    "menu.settings": "Настройки",
    "menu.view": "Вид",
    "menu.help": "Справка",
    "menu.title_settings": "Настройки тайтла...",
    "action.open_folder": "Открыть папку...",
    "action.save_project": "Сохранить проект",
    "action.export_page": "Экспорт текущей страницы",
    "action.export_page_layered": "Экспорт страницы (OpenRaster)",
    "action.export_chapter": "Экспорт главы",
    "action.exit": "Выход",
    "action.title_settings": "Настройки тайтла...",
    "action.show_overlays": "Показывать маску перевода",
    "action.about": "О программе",
    "action.ocr_translate": "OCR + Перевести",
    "action.overlay": "Оверлей",
    "action.toggle_editor": "Показать список блоков",
    "action.reset_layout": "Сбросить раскладку",
    "toolbar.mask": "Маска",
    "toolbar.mask_tooltip": "Показать/скрыть маску перевода",
    "toolbar.text": "Текст",
    "toolbar.text_tooltip": "Показать переведенный текст",
    "toolbar.sfx": "SFX",
    "toolbar.sfx_tooltip": "Показать слой SFX",
    "toolbar.brush": "Кисть",
    "toolbar.brush_tooltip": "Инструмент кисти",
    "toolbar.eraser": "Ластик",
    "toolbar.eraser_tooltip": "Инструмент ластика",
    "toolbar.eyedropper": "Пипетка",
    "toolbar.eyedropper_tooltip": "Взять цвет с переведенной страницы",
    "toolbar.hand": "Рука",
    "toolbar.hand_tooltip": "Инструмент перемещения",
    "toolbar.color": "Цвет",
    "toolbar.color_tooltip": "Выбрать цвет кисти",
    "toolbar.zoom_in": "Приблизить",
    "toolbar.zoom_in_tooltip": "Увеличить масштаб перевода",
    "toolbar.zoom_out": "Отдалить",
    "toolbar.zoom_out_tooltip": "Уменьшить масштаб перевода",
    "toolbar.zoom_reset": "100%",
    "toolbar.zoom_reset_tooltip": "Сбросить масштаб к 100%",
    "toolbar.zoom_fit_width": "По ширине",
    "toolbar.zoom_fit_width_tooltip": "Подогнать страницу по ширине",
    "title.settings": "Настройки тайтла",
    "title.about": "О программе",
    "label.original_language": "Язык оригинала",
    "label.target_language": "Язык перевода",
    "label.skip_sfx_default": "Не переводить SFX по умолчанию",
    "label.content_type": "Тип контента",
    "label.color_mode": "Цветность",
    "label.status": "Статус:",
    "label.size": "Размер:",
    "option.standard": "Обычный / 0+",
    "option.adult": "Взрослый / 18+",
    "option.bw": "Ч/Б",
    "option.color": "Цвет / вэбтун",
    "status.downloaded": "Скачан",
    "status.not_downloaded": "Не скачан",
    "actions.download": "Скачать",
    "actions.delete": "Удалить",
    "api.key": "Ключ API",
    "api.endpoint": "Endpoint",
    "api.check": "Проверить",
    "error.no_download_url": "Для этого движка не настроена ссылка на скачивание.",
    "error.enter_api_key": "Сначала введите ключ API.",
    "info.api_valid": "Ключ API принят.",
    "info.nothing_to_delete": "Нечего удалять.",
    "confirm.delete_models": "Удалить скачанные модели для этого движка?",
    "msg.no_project": "Сначала откройте папку проекта.",
    "msg.no_pages": "В проекте нет страниц.",
    "msg.invalid_index": "Текущий номер страницы некорректен.",
    "msg.no_session": "Для этой страницы нет сессии. Выполните OCR и перевод.",
    "msg.export_done": "Страница экспортирована:",
    "msg.export_error": "Ошибка экспорта страницы:",
    "msg.export_title": "Экспорт завершён",
    "msg.export_chapter_title": "Экспорт главы",
    "msg.no_pages_for_chapter": "Нет страниц для главы {chapter}.",
    "msg.export_summary": "Экспорт главы {chapter} завершён.",
    "msg.export_counts": "Экспортировано страниц: {ok} / {total}.",
    "msg.export_skipped": "Пропущены страницы (нет данных или ошибка): {pages}",
    "msg.overlay_nothing": "Нет включённых блоков с текстом для отображения.",
    "msg.overlay_nodata": "Сначала выполните OCR/перевод для этой страницы.",
    "msg.no_data": "Нет данных",
    "msg.no_project_title": "Нет проекта",
    "msg.error": "Ошибка",
    "msg.translation_error": "Ошибка перевода",
    "msg.ocr_translation_error": "Ошибка OCR/перевода",
    "msg.overlay_title": "Нечего показать",
    "msg.about_text": "{app}\nПростое приложение для OCR и перевода манги.",
    "nav.page_label": "Гл. {chapter}, стр. {page} ({current} / {total})",
    "status.project_saved": "Проект сохранён.",
    "status.project_opened": "Открыт проект: {name}",
    "status.overlay_shown": "Маска показана для страницы {page} (блоков: {blocks})",
    "status.overlay_hidden": "Маска скрыта для страницы {page}",
    "status.ocr_done": "OCR и перевод завершены для страницы {page} (блоков: {blocks})",
    "status.translation_updated": "Перевод обновлён для {count} блок(ов) на странице {page}",
    "status.ready": "Готово",
    "status.settings_saved": "Настройки сохранены.",
    "msg.ocr_not_configured": "Выберите OCR-движок в настройках.",
    "msg.translator_not_configured": "Выберите переводчик в настройках.",
    "ocr.easyocr.name": "EasyOCR",
    "ocr.easyocr.description": (
        "Офлайн OCR с многоязычными моделями детекции и распознавания (JP/KR/EN/CH). "
        "Работает на CPU, с GPU быстрее."
    ),
    "ocr.paddleocr.name": "PaddleOCR (PP-OCRv3)",
    "ocr.paddleocr.description": (
        "Офлайн OCR на PP-OCRv3 с мультиязычными моделями. Высокое качество, но крупные загрузки; "
        "с GPU работает быстрее."
    ),
    "ocr.tesseract.name": "Tesseract (tessdata_best)",
    "ocr.tesseract.description": (
        "Классический офлайн OCR с tessdata_best. Лучше всего на чистых сканах и простых шрифтах; "
        "медленнее и менее устойчив к шуму, чем EasyOCR/PaddleOCR."
    ),
    "ocr.google_vision.name": "Google Vision",
    "ocr.google_vision.description": (
        "Облачный OCR Google. Требуется API-ключ и биллинг Google Cloud; локальные модели не нужны."
    ),
    "ocr.azure_cv.name": "Azure Computer Vision",
    "ocr.azure_cv.description": (
        "Облачный OCR Azure. Требуются endpoint и ключ Azure; работает полностью в облаке."
    ),
    "translator.deepl.name": "DeepL",
    "translator.deepl.description": (
        "Можно использовать без API-ключа в веб-режиме (медленнее, есть ограничения). "
        "Если есть ключ, включите API-режим ниже для более стабильного и быстрого перевода."
    ),
    "translator.google.name": "Google Translate",
    "translator.google.description": (
        "По умолчанию работает в веб-режиме без API-ключа. Укажите ключ, чтобы переключиться в API-режим "
        "с более высокими лимитами и стабильностью."
    ),
    "translator.yandex.name": "Yandex Translate",
    "translator.yandex.description": (
        "Поддерживает веб-режим без API-ключа. При наличии ключа включите API-режим для большей стабильности и скорости."
    ),
    "translator.azure.name": "Azure Translate",
    "translator.azure.description": (
        "Нужны endpoint и ключ Azure Translator. Только API-режим; веб/скрейп не поддерживается."
    ),
    "translator.openai.name": "OpenAI (LLM)",
    "translator.openai.description": (
        "Перевод на базе LLM. Требуется API-ключ (и при необходимости кастомный endpoint) для работы."
    ),
    "translator.argos.name": "Argos Translate",
    "translator.argos.description": (
        "Офлайн-переводчик на моделях Argos. Скачивает пакеты языковых пар и после этого работает полностью локально."
    ),
    "translator.marian.name": "Marian / M2M / NLLB (HF)",
    "translator.marian.description": (
        "Офлайн-переводчики HuggingFace (MarianMT/M2M/NLLB). Модели большие; желательно GPU для скорости, "
        "на CPU будет медленнее."
    ),

}

STRINGS_RU = dict(STRINGS_EN)

STRINGS: Dict[str, Dict[str, str]] = {
    "en": STRINGS_EN,
    "ru": STRINGS_RU,
}


def tr(key: str, lang: str = "en") -> str:
    """Translate a key with fallback to English."""
    lang = (lang or "en").lower()
    if lang not in STRINGS:
        lang = "en"
    return STRINGS.get(lang, {}).get(key, STRINGS_EN.get(key, key))
